# Analyzing Uniform Participation of MPI Processes Using LLVM/Clang

This project aims to analyze the uniform participation patterns of MPI processes in C/C++ code using LLVM/Clang. By leveraging the LLVM framework, we develop a custom analysis pass that identifies MPI communication calls and detects patterns of uniform participation among MPI processes.

## Features

- **MPI Communication Analysis**: Detects and analyzes MPI_Send and MPI_Recv calls.
- **Uniform Participation Detection**: Identifies uniform participation patterns across MPI processes.
- **LLVM/Clang Integration**: Utilizes LLVM's powerful analysis and transformation capabilities.
- **Detailed Reporting**: Provides comprehensive reports on detected communication patterns.

## Explanation of Each Code File

- **[mpi_example.c](./final/mpi_example.c)**: A simple MPI program demonstrating point-to-point communication between two processes. The root process sends data to another process, which receives and prints it.

- **[MPIAnalysisPass.cpp](./final/MPIAnalysisPass.cpp)**: An LLVM pass that analyzes MPI communication patterns in the provided code. It detects MPI_Send and MPI_Recv calls, extracts relevant information, and analyzes uniform participation patterns among the MPI processes.

- **[input.ll](./final/input.ll)**: LLVM IR (Intermediate Representation) of the mpi_example.c code, generated by Clang. This file serves as the input for the LLVM pass.

## Steps to Run the Analysis

### One-Time Setup Instructions

1. **Check MPI Compiler Location:**

   ```sh
   mpicc -show
   ```

2. **Generate LLVM IR from MPI C Code:**

   ```sh
   clang -I/usr/include/lam -emit-llvm -S mpi_example.c -o input.ll
   ```

   This command generates the LLVM IR file `input.ll` from the provided MPI C code in `mpi_example.c`.

   Note: Use the `find` command to locate the MPI header files if the above command fails.

   ```sh
   find /usr -name mpi.h
   ```

   Paste the path to the MPI header files in the clang command:

   ```sh
   clang -I<mpi_header_path> -emit-llvm -S mpi_example.c -o input.ll
   ```

### Execution Instructions

1. **Compile the MPI Analysis Pass:**

   ```sh
   clang++ -shared -fPIC -o MPIAnalysisPass.so MPIAnalysisPass.cpp `llvm-config --cxxflags --ldflags --libs`
   ```

   This command compiles the MPIAnalysisPass.cpp file into a shared object file (MPIAnalysisPass.so) that can be loaded as an LLVM pass.

2. **Run the Analysis Pass:**

   ```sh
   opt -load-pass-plugin=./MPIAnalysisPass.so -passes="mpi-analysis" < input.ll > /dev/null
   ```

   This command runs the MPI analysis pass on the LLVM IR file `input.ll` and generates the analysis report. The `MPIAnalysisPass.so` shared object file is loaded as a plugin, and the `mpi-analysis` pass is executed on the input LLVM IR.

## Output Example

![alt text](./images/output.png)

## Prerequisites

- **LLVM/Clang:** Ensure you have LLVM and Clang installed.
- **MPI Library:** Ensure you have an MPI library installed, such as OpenMPI or MPICH.
